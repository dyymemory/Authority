var DepartmentIndex = {
    TabType1: true,//U+门前权限第一次加载
    TabType2: true,//U+地理权限第一次加载
    TabDivisition1: true,//门店管辖-能看我的第一次加载
    TabDept1: true,//U+门前权限-能看我的第一次加载
	TabArea1: true,//U+地理权限-能看我的第一次加载
	TypeCodeSelected: "",//U+门店权限我能看的 radio 选中的
	DepartOnlyCodeSelected:"",// 主树选择的部门
	DivisitionCanSeeSelectedNodes: [],//管辖权限我能看的部门树选中节点
    DivisitionBeSeenSelectedNodes: [],//管辖权限能看我的部门树选中节点
    FySelCanSeeSelectedNodes: [],//查看房源我能看的部门树选中节点
    FySelBeSeenSelectedNodes: [],//查看房源能看我的部门树选中节点
    CustSelCanSeeSelectedNodes: [],//查看客源我能看的部门树选中节点
    CustSelBeSeenSelectedNodes: [],//查看客源能看我的部门树选中节点
    PublicOwnerCanSeeSelectedNodes: [],//公盘看业主我能看的部门树选中节点
    PublicOwnerBeSeenSelectedNodes: [],//公盘看业主能看我的部门树选中节点
    PrivateOwnerCanSeeSelectedNodes: [],//私盘看业主我能看的部门树选中节点
    PrivateOwnerBeSeenSelectedNodes: [],//私盘看业主能看我的部门树选中节点
    CommonOwnerCanSeeSelectedNodes: [],//公共池房源看业主我能看的部门树选中节点
    CommonOwnerBeSeenSelectedNodes: [],//公共池房源看业主能看我的部门树选中节点
    FyFellowCanSeeSelectedNodes: [],//房源看跟进我能看的部门树选中节点
    FyFellowBeSeenSelectedNodes: [],//房源看跟进能看我的部门树选中节点
    CustFellowCanSeeSelectedNodes: [],//客源看跟进我能看的部门树选中节点
    CustFellowBeSeenSelectedNodes: [],//客源看跟进能看我的部门树选中节点
    UplusCanSeeSelectedNodes: { FySel: [], CustSel: [], PublicOwner: [], PrivateOwner: [], CommonOwner: [], FyFellow: [], CustFellow: [] },//U+系统我能看的部门树选中节点
    Init: function () {
        layui.use(['element', 'form', 'layer'], function () {
            var element = layui.element,
                form = layui.form,
                layer = layui.layer;

            //var user = CacheHelper.GetUser();

            //面板监听事件
            $('.site-demo-active').on('click', function () {
                var othis = $(this), type = othis.data('type');
                active[type] ? active[type].call(this, othis) : '';
            });
  
            form.render();
            ////复制权限到门店员工
            $('#CopyDivisitionCanSee').on('click', function () {
                layer.open({
                    type: 2,
                    title: ["复制管辖权限到员工", "font-size:22px;color:black"],
                    area: ['53%', '80%'], //宽高
                    content: 'department/department_edit.html',
                    scrollbar: false,//禁用滚动条
                    btnAlign: 'd',

                });
            });
            form.on('select(City)', function () {
                ControlComm.DepartmentBinding($('#Department'), form, $('#City').val());
                DepartmentIndex.GetDeptTreeNoCheck($('#deptTree'), $('#City').val());
            });
            form.on('select(Department)', function () {
                var listSorted = DepartmentIndex.GetTreeListSorted($('#Department').find('option:selected').eq(0), CacheHelper.GetDepartment($('#City').val()));
                DepartmentIndex.GetDeptTreeNoCheck($('#deptTree'), $('#City').val(), listSorted);
            });

            //门店管辖我能看的事件监听
            form.on('select(CityDivisitionCanSee)', function () {
                ControlComm.DepartmentBinding($('#DepartmentDivisitionCanSee'), form, $('#CityDivisitionCanSee').val());
                var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                if (!!dept && dept.DepartOnlyCode > 0) {
                    PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDivisitionCanSee').val(), 'DepartOnlyCode': dept.DepartOnlyCode, 'TypeCodeList': ['dep-divisition-sel'], 'ViewType': 1 }, true, function (result) {
                        DepartmentIndex.DivisitionCanSeeSelectedNodes = [];
                        if (!!result) {
                            layui.each(result.Data, function () {
                                DepartmentIndex.DivisitionCanSeeSelectedNodes.push(this.DataCode);
                            });
                        }
                        ControlComm.GetDeptTree($('#TreeDivisitionCanSee'), $('#CityDivisitionCanSee').val(), DepartmentIndex.DivisitionCanSeeSelectedNodes);
                    });
                } else {
                    ControlComm.GetDeptTree($('#TreeDivisitionCanSee'), $('#CityDivisitionCanSee').val());
                }
            });
            form.on('select(DepartmentDivisitionCanSee)', function () {
                DepartmentIndex.RefreshSelectedNodes("TreeDivisitionCanSee", DepartmentIndex.DivisitionCanSeeSelectedNodes);
                var listSorted = $('#DepartmentDivisitionCanSee').val() == '' ? null : DepartmentIndex.GetTreeListSorted($('#DepartmentDivisitionCanSee').find('option:selected').eq(0), CacheHelper.GetDepartment($('#CityDivisitionCanSee').val()));
                ControlComm.GetDeptTree($('#TreeDivisitionCanSee'), $('#CityDivisitionCanSee').val(), DepartmentIndex.DivisitionCanSeeSelectedNodes, listSorted);
            });
            $('#SaveDivisitionCanSee').on('click', function () {
                var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                if (!DepartmentIndex.ValidateDeptTreeSelected(dept)) {
                    return;
                }
                DepartmentIndex.RefreshSelectedNodes("TreeDivisitionCanSee", DepartmentIndex.DivisitionCanSeeSelectedNodes);
                var param = {};
                param.DepartOnlyCode = dept.DepartOnlyCode;
                param.CityID = $('#CityDivisitionCanSee').val();
                param.DepDivisitionSel = DepartmentIndex.DivisitionCanSeeSelectedNodes;
                param.TypeCodeList = ['dep-divisition-sel'];
                param.ViewType = 1;
                PublicComm.Ajax("POST", "/Authority/Privilege/SavePrivDepartment", param, true, function (result) {
                    if (!!result) {
                        if (result.Code == 2000) {
                            layer.alert("保存成功");
                        } else {
                            layer.alert("保存失败，原因：" + result.Message);
                        }
                    }
                });
            });
            $('#CheckedAllDivisitionCanSee').on('click', function () {
                DepartmentIndex.CheckAllNodes("TreeDivisitionCanSee", true);
            });
            $('#UnCheckedAllDivisitionCanSee').on('click', function () {
                DepartmentIndex.CheckAllNodes("TreeDivisitionCanSee", false);
            });

            //门店管辖能看我的事件监听
            form.on('select(CityDivisitionBeSeen)', function () {
                ControlComm.DepartmentBinding($('#DepartmentDivisitionBeSeen'), form, $('#CityDivisitionBeSeen').val());
                var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                if (!!dept && dept.DepartOnlyCode > 0) {
                    PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDivisitionBeSeen').val(), 'DataCode': dept.DepartOnlyCode, 'TypeCodeList': ['dep-divisition-sel'], 'ViewType': 2 }, true, function (result) {
                        DepartmentIndex.DivisitionBeSeenSelectedNodes = [];
                        if (!!result) {
                            layui.each(result.Data, function () {
                                DepartmentIndex.DivisitionBeSeenSelectedNodes.push(this.DepartOnlyCode);
                            });
                        }
                        ControlComm.GetDeptTree($('#TreeDivisitionBeSeen'), $('#CityDivisitionBeSeen').val(), DepartmentIndex.DivisitionBeSeenSelectedNodes);
                    });
                } else {
                    ControlComm.GetDeptTree($('#TreeDivisitionBeSeen'), $('#CityDivisitionBeSeen').val());
                }
            });
            form.on('select(DepartmentDivisitionBeSeen)', function () {
                DepartmentIndex.RefreshSelectedNodes("TreeDivisitionBeSeen", DepartmentIndex.DivisitionBeSeenSelectedNodes);
                var listSorted = $('#DepartmentDivisitionBeSeen').val() == '' ? null : DepartmentIndex.GetTreeListSorted($('#DepartmentDivisitionBeSeen').find('option:selected').eq(0), CacheHelper.GetDepartment($('#CityDivisitionBeSeen').val()));
                ControlComm.GetDeptTree($('#TreeDivisitionBeSeen'), $('#CityDivisitionBeSeen').val(), DepartmentIndex.DivisitionBeSeenSelectedNodes, listSorted);
            });
            $('#SaveDivisitionBeSeen').on('click', function () {
                var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                if (!DepartmentIndex.ValidateDeptTreeSelected(dept)) {
                    return;
                }
                DepartmentIndex.RefreshSelectedNodes("TreeDivisitionBeSeen", DepartmentIndex.DivisitionBeSeenSelectedNodes);
                var param = {};
                param.DataCode = dept.DepartOnlyCode;
                param.CityID = $('#CityDivisitionBeSeen').val();
                param.DepDivisitionSel = DepartmentIndex.DivisitionBeSeenSelectedNodes;
                param.ViewType = 2;
                param.TypeCodeList = ['dep-divisition-sel'];
                PublicComm.Ajax("POST", "/Authority/Privilege/SavePrivDepartment", param, true, function (result) {
                    if (!!result) {
                        if (result.Code == 2000) {
                            layer.alert("保存成功");
                        } else {
                            layer.alert("保存失败，原因：" + result.Message);
                        }
                    }
                });
            });
            $('#CheckedAllDivisitionBeSeen').on('click', function () {
                DepartmentIndex.CheckAllNodes("TreeDivisitionBeSeen", true);
            });
            $('#UnCheckedAllDivisitionBeSeen').on('click', function () {
                DepartmentIndex.CheckAllNodes("TreeDivisitionBeSeen", false);
            });

            //U+门店权限设置我能看的
            form.on('select(CityDeptCanSee)', function () {
                ControlComm.DepartmentBinding($('#DepartmentDeptCanSee'), form, $('#CityDeptCanSee').val());
                var typeCode = $('input:radio[name=TypeCode]:checked').val();
                var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                if (!!dept && dept.DepartOnlyCode > 0) {
                    PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDeptCanSee').val(), 'DepartOnlyCode': dept.DepartOnlyCode, 'TypeCodeList': [typeCode], 'ViewType': 1 }, true, function (result) {
                        var data = [];
                        if (!!result) {
                            data = result.Data;
                        }
                        DepartmentIndex.RefreshUplusCanSeeSelectedNodes(typeCode, data);
                        ControlComm.GetDeptTree($('#deptDataTree'), $('#CityDeptCanSee').val(), DepartmentIndex.GetUplusCanSeeSelectedNodesByTypeCode(typeCode));
                    });
                } else {
                    ControlComm.GetDeptTree($('#deptDataTree'), $('#CityDeptCanSee').val());
                }

                if (!!dept && dept.DepartOnlyCode > 0) {
                    PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDeptCanSee').val(), 'DepartOnlyCode': dept.DepartOnlyCode, 'TypeCodeList': ['dep-fy-sel', 'dep-cust-sel', 'dep-public-owner', 'dep-private-owner', 'dep-common-owner', 'dep-fy-fellow', 'dep-cust-fellow'], 'ViewType': 1 }, true, function (result) {
                        var data = [];
                        if (!!result) {
                            data = result.Data;
                        }
                        DepartmentIndex.BatchRefreshUplusCanSeeSelectedNodes(data);

                        DepartmentIndex.GetTreeTable(form, $('#CityDeptCanSee').val(), DepartmentIndex.UplusCanSeeSelectedNodes);
                    });
                } else {
                    DepartmentIndex.GetTreeTable(form, $('#CityDeptCanSee').val());
                }

            });
            form.on('select(DepartmentDeptCanSee)', function () {
                var listSorted = $('#DepartmentDeptCanSee').val() == '' ? null : DepartmentIndex.GetTreeListSorted($('#DepartmentDeptCanSee').find('option:selected').eq(0), CacheHelper.GetDepartment($('#CityDeptCanSee').val()));

                var typeCode = $('input:radio[name=TypeCode]:checked').val();
                var arrDept = DepartmentIndex.GetUplusCanSeeSelectedNodesByTypeCode(typeCode);
                DepartmentIndex.RefreshSelectedNodes("deptDataTree", arrDept);
                ControlComm.GetDeptTree($('#deptDataTree'), $('#CityDeptCanSee').val(), arrDept, listSorted);

                DepartmentIndex.RefreshTreeTableSelectedNodes(DepartmentIndex.UplusCanSeeSelectedNodes);
                DepartmentIndex.GetTreeTable(form, $('#CityDeptCanSee').val(), DepartmentIndex.UplusCanSeeSelectedNodes, listSorted);
            });
            $('#SaveTreeTable').on('click', function () {
                var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                if (!DepartmentIndex.ValidateDeptTreeSelected(dept)) {
                    return;
                }

                DepartmentIndex.RefreshTreeTableSelectedNodes(DepartmentIndex.UplusCanSeeSelectedNodes);
                var param = {};
                param.DepartOnlyCode = dept.DepartOnlyCode;
                param.CityID = $('#CityDeptCanSee').val();
                param.DepFySel = DepartmentIndex.UplusCanSeeSelectedNodes.FySel;
                param.DepCustSel = DepartmentIndex.UplusCanSeeSelectedNodes.CustSel;
                param.DepPublicOwner = DepartmentIndex.UplusCanSeeSelectedNodes.PublicOwner;
                param.DepPrivateOwner = DepartmentIndex.UplusCanSeeSelectedNodes.PrivateOwner;
                param.DepCommonOwner = DepartmentIndex.UplusCanSeeSelectedNodes.CommonOwner;
                param.DepFyFellow = DepartmentIndex.UplusCanSeeSelectedNodes.FyFellow;
                param.DepCustFellow = DepartmentIndex.UplusCanSeeSelectedNodes.CustFellow;
                param.TypeCodeList = ['dep-fy-sel', 'dep-cust-sel', 'dep-public-owner', 'dep-private-owner', 'dep-common-owner', 'dep-fy-fellow', 'dep-cust-fellow'];
                param.ViewType = 1;
                PublicComm.Ajax("POST", "/Authority/Privilege/SavePrivDepartment", param, true, function (result) {
                    if (!!result) {
                        if (result.Code == 2000) {
                            layer.alert("保存成功");
                        } else {
                            layer.alert("保存失败，原因：" + result.Message);
                        }
                    }
                });
            });
            $('#SaveTypeCode').on('click', function () {
                var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                if (!DepartmentIndex.ValidateDeptTreeSelected(dept)) {
                    return;
                }

                var typeCode = $('input:radio[name=TypeCode]:checked').val();
                var paramName = DepartmentIndex.GetUplusParamNameByTypeCode(typeCode);
                var arrDept = DepartmentIndex.GetUplusCanSeeSelectedNodesByTypeCode(typeCode);
                DepartmentIndex.RefreshSelectedNodes("deptDataTree", arrDept);
                var param = {};
                param.DepartOnlyCode = dept.DepartOnlyCode;
                param.CityID = $('#CityDeptCanSee').val();
                param[paramName] = arrDept;
                param.TypeCodeList = [typeCode];
                param.ViewType = 1;
                PublicComm.Ajax("POST", "/Authority/Privilege/SavePrivDepartment", param, true, function (result) {
                    if (!!result) {
                        if (result.Code == 2000) {
							layer.alert("保存成功");
                        } else {
                            layer.alert("保存失败，原因：" + result.Message);
                        }
                    }
                });
            });
            $('#CheckedAllTypeCode').on('click', function () {
                DepartmentIndex.CheckAllNodes("deptDataTree", true);
            });
            $('#UnCheckedAllTypeCode').on('click', function () {
                DepartmentIndex.CheckAllNodes("deptDataTree", false);
            });

            //U+门店权限能看我的
            form.on('select(CityDeptBeSeen)', function () {
                ControlComm.DepartmentBinding($('#DepartmentDeptBeSeen'), form, $('#CityDeptBeSeen').val());

                var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                if (!!dept && dept.DepartOnlyCode > 0) {
                    var typeCode = $('input:radio[name=TypeCodeBeSeen]:checked').val();
                    PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDeptBeSeen').val(), 'DataCode': dept.DepartOnlyCode, 'TypeCodeList': [typeCode], 'ViewType': 2 }, true, function (result) {
                        var data = [];
                        if (!!result) {
                            data = result.Data;
                        }
                        DepartmentIndex.RefreshUplusBeSeenSelectedNodes(typeCode, data);
                        ControlComm.GetDeptTree($('#deptDataTreeBeSeen'), $('#CityDeptBeSeen').val(), DepartmentIndex.GetUplusBeSeenSelectedNodesByTypeCode(typeCode));
                    });
                } else {
                    ControlComm.GetDeptTree($('#deptDataTreeBeSeen'), $('#CityDeptBeSeen').val());
                }
            });
            form.on('select(DepartmentDeptBeSeen)', function () {
                var listSorted = $('#DepartmentDeptCanSee').val() == '' ? null : DepartmentIndex.GetTreeListSorted($('#DepartmentDeptBeSeen').find('option:selected').eq(0), CacheHelper.GetDepartment($('#CityDeptBeSeen').val()));

                var typeCode = $('input:radio[name=TypeCodeBeSeen]:checked').val();
                var arrDept = DepartmentIndex.GetUplusBeSeenSelectedNodesByTypeCode(typeCode);
                DepartmentIndex.RefreshSelectedNodes("deptDataTreeBeSeen", arrDept);
                ControlComm.GetDeptTree($('#deptDataTreeBeSeen'), $('#CityDeptBeSeen').val(), arrDept, listSorted);
            });
            $('#SaveTypeCodeBeSeen').on('click', function () {
                var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                if (!DepartmentIndex.ValidateDeptTreeSelected(dept)) {
                    return;
                }

                var typeCode = $('input:radio[name=TypeCodeBeSeen]:checked').val();
                var paramName = DepartmentIndex.GetUplusParamNameByTypeCode(typeCode);
                var arrDept = DepartmentIndex.GetUplusBeSeenSelectedNodesByTypeCode(typeCode);
                DepartmentIndex.RefreshSelectedNodes("deptDataTreeBeSeen", arrDept);
                var param = {};
                param.DataCode = dept.DepartOnlyCode;
                param.CityID = $('#CityDeptBeSeen').val();
                param[paramName] = arrDept;
                param.TypeCodeList = [typeCode];
                param.ViewType = 2;
                PublicComm.Ajax("POST", "/Authority/Privilege/SavePrivDepartment", param, true, function (result) {
                    if (!!result) {
                        if (result.Code == 2000) {
                            layer.alert("保存成功");
                        } else {
                            layer.alert("保存失败，原因：" + result.Message);
                        }
                    }
                });
            });
            $('#CheckedAllTypeCodeBeSeen').on('click', function () {
                DepartmentIndex.CheckAllNodes("deptDataTreeBeSeen", true);
            });
            $('#UnCheckedAllTypeCodeBeSeen').on('click', function () {
                DepartmentIndex.CheckAllNodes("deptDataTreeBeSeen", false);
            });

            form.on('select(CityAreaCanSee)', function () {
                ControlComm.DepartmentBinding($('#DepartmentAreaCanSee'), form, $('#CityAreaCanSee').val());
            });
            form.on('select(CityAreaBeSeen)', function () {
                ControlComm.DepartmentBinding($('#DepartmentAreaBeSeen'), form, $('#CityAreaBeSeen').val());
            });

            // U+门店权限 我能看的 复制权限到门店
			$('#CopyTypeCode').on('click', function () {
				var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
				console.log(dept);
				if (!DepartmentIndex.ValidateDeptTreeSelected(dept)) {
					return;
				}
				console.log(DepartmentIndex.FySelCanSeeSelectedNodes);
				DepartmentIndex.DepartOnlyCodeSelected = dept.DepartOnlyCode;
                var treeObj = $.fn.zTree.getZTreeObj("deptDataTree");
                if (!!treeObj) {
                    var CityID = $('#CityDeptCanSee').val();
                    var DeptID = $("#DepartmentDeptCanSee").val();
                    layui.use("layer", function () {
                        var layer = layui.layer;
						layer.open({
							type: 2,
							title: '',
							area: ['53%', '80%'], //宽高
							content: 'department/department_copyprivtodep.html#' + CityID + '',
							scrollbar: false,//禁用滚动条
							btnAlign: 'd'
						});
                    });
				};
            });

            ControlComm.CityBinding($('#City'), form);
            ControlComm.CityBinding($('#CityDivisitionCanSee'), form);
            ControlComm.CityBinding($('#CityDivisitionBeSeen'), form);
            ControlComm.CityBinding($('#CityDeptCanSee'), form);
            ControlComm.CityBinding($('#CityDeptBeSeen'), form);
            ControlComm.CityBinding($('#CityAreaCanSee'), form);
            ControlComm.CityBinding($('#CityAreaBeSeen'), form);

            //$('#Search').on('click', function () {
            //    var param = {};
            //    if (!$('#City').val()) {
            //        layer.msg("请选择城市");
            //        return;
            //    } else {
            //        param.CityID = $('#City').val();
            //    }
            //    DepartmentIndex.GetDeptTreeNoCheck($('#deptTree'), param);
            //});

            $('#oneType').hide();
            //U+门店权限我能看的radio事件
            form.on('radio(TypeCode)', function () {
                var typeCode = $('input:radio[name=TypeCode]:checked').val();
                DepartmentIndex.TypeCodeSelected = typeCode;
                if (typeCode == 'all') {
                    $('#allType').show();
                    $('#oneType').hide();
                } else {
                    $('#allType').hide();
                    $('#oneType').show();


                    var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                    if (!!dept && dept.DepartOnlyCode > 0) {
                        var deptDataTree = $.fn.zTree.getZTreeObj("deptDataTree");
                        if (!!deptDataTree) {
                            PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDeptCanSee').val(), 'DepartOnlyCode': dept.DepartOnlyCode, 'TypeCodeList': [typeCode], 'ViewType': 1 }, true, function (result) {
                                deptDataTree.checkAllNodes(false);
                                var data = [];
                                if (!!result) {
                                    for (var i = 0; i < result.Data.length; i++) {
                                        var node = deptDataTree.getNodeByParam("DepartOnlyCode", result.Data[i].DataCode);
                                        if (node != null) {
                                            deptDataTree.checkNode(node, true);
                                        }
                                    };
                                    data = result.Data;
                                }
                                DepartmentIndex.RefreshUplusCanSeeSelectedNodes(typeCode, data);
                            });
                        }
                    }

                }
            });

            //U+门店权限能看我的radio事件
            form.on('radio(TypeCodeBeSeen)', function () {
                var typeCode = $('input:radio[name=TypeCodeBeSeen]:checked').val();
                var dept = DepartmentIndex.GetDeptTreeSelectedNodes();
                if (!!dept && dept.DepartOnlyCode > 0) {
                    var deptDataTreeBeSeen = $.fn.zTree.getZTreeObj("deptDataTreeBeSeen");
                    if (!!deptDataTreeBeSeen) {
                        PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDeptBeSeen').val(), 'DataCode': dept.DepartOnlyCode, 'TypeCodeList': [typeCode], 'ViewType': 2 }, true, function (result) {
                            deptDataTreeBeSeen.checkAllNodes(false);
                            var data = [];
                            if (!!result) {
                                for (var i = 0; i < result.Data.length; i++) {
                                    var node = deptDataTreeBeSeen.getNodeByParam("DepartOnlyCode", result.Data[i].DepartOnlyCode);
                                    if (node != null) {
                                        deptDataTreeBeSeen.checkNode(node, true);
                                    }
                                };
                                data = result.Data;
                            }
                            DepartmentIndex.RefreshUplusBeSeenSelectedNodes(typeCode, data);
                        });
                    }
                }

            });

            //管辖权限-U+门店权限-U+地理权限面板监听事件
            element.on('tab(TabType)', function (data) {
                //U+门店权限-我能看的
                if (DepartmentIndex.TabType1 && data.index == 1) {
                    DepartmentIndex.TabType1 = false;
                }
                    //U+地理权限-我能看的
                else if (DepartmentIndex.TabType2 && data.index == 2) {
                    DepartmentIndex.TabType2 = false;
                }
            });

            //管辖权限--能看我的面板事件
            element.on('tab(TabDivisition)', function (data) {
                if (DepartmentIndex.TabDivisition1 && data.index == 1) {
                    DepartmentIndex.TabDivisition1 = false;
                }
            });

            //U+门店权限--能看我的面板事件
            element.on('tab(TabDept)', function (data) {
                if (DepartmentIndex.TabDept1 && data.index == 1) {
                    DepartmentIndex.TabDept1 = false;
                }
            });

            //U+地理权限--能看我的面板事件
            element.on('tab(TabArea)', function (data) {
                if (DepartmentIndex.TabArea1 && data.index == 1) {
                    DepartmentIndex.TabArea1 = false;
                }
            });
        });
    },
    /// <summary>
    /// 根据当前树选择节点刷新完整树选择的节点
    ///<param name="treeId">树id</param>
    ///<param name="arr">当前树选择的节点数组</param>
    /// </summary>/
    RefreshSelectedNodes: function (treeId, arr) {
        var zTreeObj = $.fn.zTree.getZTreeObj(treeId);
        if (!!zTreeObj) {
            var unCheckedNodes = zTreeObj.getCheckedNodes(false);
            layui.each(unCheckedNodes, function () {
                if (arr.indexOf(this.DepartOnlyCode) >= 0) {
                    arr.splice(arr.indexOf(this.DepartOnlyCode), 1);
                }
            });
            var checkedNodes = zTreeObj.getCheckedNodes(true);
            layui.each(checkedNodes, function () {
                if (arr.indexOf(this.DepartOnlyCode) == -1) {
                    arr.push(this.DepartOnlyCode);
                }
            });
        }
    },
    RefreshTreeTableSelectedNodes: function (jsonDeptData) {
        layui.each($('input:checkbox[TypeCode="dep-fy-sel"]:not(:checked)'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.FySel.indexOf(departOnlyCode) >= 0) {
                jsonDeptData.FySel.splice(jsonDeptData.FySel.indexOf(departOnlyCode), 1);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-fy-sel"]:checked'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.FySel.indexOf(departOnlyCode) == -1) {
                jsonDeptData.FySel.push(departOnlyCode);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-cust-sel"]:not(:checked)'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.CustSel.indexOf(departOnlyCode) >= 0) {
                jsonDeptData.CustSel.splice(jsonDeptData.CustSel.indexOf(departOnlyCode), 1);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-cust-sel"]:checked'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.CustSel.indexOf(departOnlyCode) == -1) {
                jsonDeptData.CustSel.push(departOnlyCode);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-public-owner"]:not(:checked)'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.PublicOwner.indexOf(departOnlyCode) >= 0) {
                jsonDeptData.PublicOwner.splice(jsonDeptData.PublicOwner.indexOf(departOnlyCode), 1);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-public-owner"]:checked'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.PublicOwner.indexOf(departOnlyCode) == -1) {
                jsonDeptData.PublicOwner.push(departOnlyCode);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-private-owner"]:not(:checked)'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.PrivateOwner.indexOf(departOnlyCode) >= 0) {
                jsonDeptData.PrivateOwner.splice(jsonDeptData.PrivateOwner.indexOf(departOnlyCode), 1);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-private-owner"]:checked'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.PrivateOwner.indexOf(departOnlyCode) == -1) {
                jsonDeptData.PrivateOwner.push(departOnlyCode);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-common-owner"]:not(:checked)'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.CommonOwner.indexOf(departOnlyCode) >= 0) {
                jsonDeptData.CommonOwner.splice(jsonDeptData.CommonOwner.indexOf(departOnlyCode), 1);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-common-owner"]:checked'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.CommonOwner.indexOf(departOnlyCode) == -1) {
                jsonDeptData.CommonOwner.push(departOnlyCode);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-fy-fellow"]:not(:checked)'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.FyFellow.indexOf(departOnlyCode) >= 0) {
                jsonDeptData.FyFellow.splice(jsonDeptData.FyFellow.indexOf(departOnlyCode), 1);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-fy-fellow"]:checked'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.FyFellow.indexOf(departOnlyCode) == -1) {
                jsonDeptData.FyFellow.push(departOnlyCode);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-cust-fellow"]:not(:checked)'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.CustFellow.indexOf(departOnlyCode) >= 0) {
                jsonDeptData.CustFellow.splice(jsonDeptData.CustFellow.indexOf(departOnlyCode), 1);
            }
        });
        layui.each($('input:checkbox[TypeCode="dep-cust-fellow"]:checked'), function () {
            var departOnlyCode = parseInt($(this).attr('DepartOnlyCode'));
            if (jsonDeptData.CustFellow.indexOf(departOnlyCode) == -1) {
                jsonDeptData.CustFellow.push(departOnlyCode);
            }
        });
    },
    CheckAllNodes: function (treeId, bool) {
        var zTreeObj = $.fn.zTree.getZTreeObj(treeId);
        if (!!zTreeObj) {
            zTreeObj.checkAllNodes(bool);
        }
    },
    GetDeptTreeNoCheck: function (element, cityid, listSorted) {
        var zTree;
        var zTreeOnClick = function (event, treeId, treeNode) {
            //门限管辖权限我能看的
            var TreeDivisitionCanSee = $.fn.zTree.getZTreeObj("TreeDivisitionCanSee");
            if (!!TreeDivisitionCanSee) {
                PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDivisitionCanSee').val(), 'DepartOnlyCode': treeNode.DepartOnlyCode, 'TypeCodeList': ['dep-divisition-sel'], 'ViewType': 1 }, true, function (result) {
                    DepartmentIndex.DivisitionCanSeeSelectedNodes = [];
                    TreeDivisitionCanSee.checkAllNodes(false);
                    if (!!result) {
                        for (var i = 0; i < result.Data.length; i++) {
                            var node = TreeDivisitionCanSee.getNodeByParam("DepartOnlyCode", result.Data[i].DataCode);
                            if (node != null) {
                                TreeDivisitionCanSee.checkNode(node, true);
                            }
                        };
                        layui.each(result.Data, function () {
                            DepartmentIndex.DivisitionCanSeeSelectedNodes.push(this.DataCode);
                        });
                    }
                });
            }

            //门限管辖权限能看我的
            var TreeDivisitionBeSeen = $.fn.zTree.getZTreeObj("TreeDivisitionBeSeen");
            if (!!TreeDivisitionBeSeen) {
                PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDivisitionBeSeen').val(), 'DataCode': treeNode.DepartOnlyCode, 'TypeCodeList': ['dep-divisition-sel'], 'ViewType': 2 }, true, function (result) {
                    DepartmentIndex.DivisitionBeSeenSelectedNodes = [];
                    TreeDivisitionBeSeen.checkAllNodes(false);
                    if (!!result) {
                        for (var i = 0; i < result.Data.length; i++) {
                            var node = TreeDivisitionBeSeen.getNodeByParam("DepartOnlyCode", result.Data[i].DepartOnlyCode);
                            if (node != null) {
                                TreeDivisitionBeSeen.checkNode(node, true);
                            }
                        };
                        layui.each(result.Data, function () {
                            DepartmentIndex.DivisitionBeSeenSelectedNodes.push(this.DataCode);
                        });
                    }
                });
            }

            //U+门店权限我能看的
            var typeCode = $('input:radio[name=TypeCode]:checked').val();
            var deptDataTree = $.fn.zTree.getZTreeObj("deptDataTree");
            if (!!deptDataTree) {
                PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDeptCanSee').val(), 'DepartOnlyCode': treeNode.DepartOnlyCode, 'TypeCodeList': [typeCode], 'ViewType': 1 }, true, function (result) {
                    deptDataTree.checkAllNodes(false);
                    var data = [];
                    if (!!result) {
                        for (var i = 0; i < result.Data.length; i++) {
                            var node = deptDataTree.getNodeByParam("DepartOnlyCode", result.Data[i].DataCode);
                            if (node != null) {
                                deptDataTree.checkNode(node, true);
                            }
                        };
                        data = result.Data;
                    }
                    DepartmentIndex.RefreshUplusCanSeeSelectedNodes(typeCode, data);
                });
            }

            if ($("#treeTable tbody").children().length > 0) {
                PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDeptCanSee').val(), 'DepartOnlyCode': treeNode.DepartOnlyCode, 'TypeCodeList': ['dep-fy-sel', 'dep-cust-sel', 'dep-public-owner', 'dep-private-owner', 'dep-common-owner', 'dep-fy-fellow', 'dep-cust-fellow'], 'ViewType': 1 }, true, function (result) {
                    var data = [];
                    if (!!result) {
                        data = result.Data;
                    }
                    DepartmentIndex.BatchRefreshUplusCanSeeSelectedNodes(data);
                    $('input:checkbox[TypeCode="dep-fy-sel"]').prop('checked', false);
                    $('input:checkbox[TypeCode="dep-cust-sel"]').prop('checked', false);
                    $('input:checkbox[TypeCode="dep-public-owner"]').prop('checked', false);
                    $('input:checkbox[TypeCode="dep-private-owner"]').prop('checked', false);
                    $('input:checkbox[TypeCode="dep-common-owner"]').prop('checked', false);
                    $('input:checkbox[TypeCode="dep-fy-fellow"]').prop('checked', false);
                    $('input:checkbox[TypeCode="dep-cust-fellow"]').prop('checked', false);
                    DepartmentIndex.SetTreeTableStatus(DepartmentIndex.UplusCanSeeSelectedNodes);
                    layui.use('form', function () {
                        layui.form.render('checkbox');
                    });
                });
            }

            //U+门店权限能看我的
            var typeCodeBeSeen = $('input:radio[name=TypeCodeBeSeen]:checked').val();
            var deptDataTreeBeSeen = $.fn.zTree.getZTreeObj("deptDataTreeBeSeen");
            if (!!deptDataTreeBeSeen) {
                PublicComm.Ajax('POST', '/Authority/Privilege/GetPrivDepartmentList', { 'CityID': $('#CityDeptCanSee').val(), 'DataCode': treeNode.DepartOnlyCode, 'TypeCodeList': [typeCodeBeSeen], 'ViewType': 2 }, true, function (result) {
                    deptDataTreeBeSeen.checkAllNodes(false);
                    var data = [];
                    if (!!result) {
                        for (var i = 0; i < result.Data.length; i++) {
                            var node = deptDataTreeBeSeen.getNodeByParam("DepartOnlyCode", result.Data[i].DepartOnlyCode);
                            if (node != null) {
                                deptDataTreeBeSeen.checkNode(node, true);
                            }
                        };
                        data = result.Data;
                    }
                    DepartmentIndex.RefreshUplusBeSeenSelectedNodes(typeCodeBeSeen, data);
                });
            }
        };
        var setting = {
            view: {
                selectedMulti: false
            },
            check: {
                enable: false,
                chkStyle: "checkbox",
                chkboxType: { "Y": "ps", "N": "ps" }
            },
            data: {
                simpleData: {
                    enable: true,
                    idKey: "DeptNo",
                    pIdKey: "ParentDeptNo",
                    rootPId: 0
                }
				,
                key: {
                    checked: "checked",
                    name: "DeptName",
                    id: "DepartOnlyCode"
                }
            },
            edit: {
                enable: false
            },
            callback: {    //第一步
                onClick: zTreeOnClick
            }
        };
        if (!!listSorted) {
            zTree = $.fn.zTree.init(element, setting, listSorted);
            zTree.expandAll(true);
        } else {
            if (!!CacheHelper.GetDepartment($('#City').val())) {
                zTree = $.fn.zTree.init(element, setting, CacheHelper.GetDepartment($('#City').val()));
                zTree.expandAll(true);
            } else {
                PublicComm.Ajax("POST", '/Authority/Department/GetDepartmentListByCity', { CityID: $('#City').val() }, true, function (result) {
                    CacheHelper.SetDepartment($('#City').val(), result.Data);
                    zTree = $.fn.zTree.init(element, setting, CacheHelper.GetDepartment($('#City').val()));
                    zTree.expandAll(true);
                });
            }
        }
    },
    GetTreeTable: function (form, cityid, jsonDeptData, listSorted) {
        var InitTreeTable = function (listDept) {
            $("#treeTable tbody").html(DepartmentIndex.BuildDeptDataPermissionHTML(listDept));
            $("#treeTable").treetable({
                expandable: true,
                clickableNodeNames: true,
            }, true);
            //$("#treeTable").treetable("expandAll");//展开全部
            if (!!jsonDeptData) {
                DepartmentIndex.SetTreeTableStatus(jsonDeptData);
            }
            form.render();
        };
        if (!!listSorted) {
            InitTreeTable(listSorted);
        } else {
            if (!!CacheHelper.GetDepartment(cityid)) {
                InitTreeTable(CacheHelper.GetDepartment(cityid));
            } else {
                PublicComm.Ajax("POST", '/Authority/Department/GetDepartmentListByCity', { CityID: cityid }, true, function (result) {
                    CacheHelper.SetDepartment(cityid, result.Data);
                    InitTreeTable(CacheHelper.GetDepartment(cityid));
                });
            }
        }
    },
    SetTreeTableStatus: function (jsonDeptData) {
        layui.each(jsonDeptData.FySel, function (index, item) {
            $('input:checkbox[DepartOnlyCode=' + item + '][TypeCode="dep-fy-sel"]').prop('checked', true);
        });
        layui.each(jsonDeptData.CustSel, function (index, item) {
            $('input:checkbox[DepartOnlyCode=' + item + '][TypeCode="dep-cust-sel"]').prop('checked', true);
        });
        layui.each(jsonDeptData.PublicOwner, function (index, item) {
            $('input:checkbox[DepartOnlyCode=' + item + '][TypeCode="dep-public-owner"]').prop('checked', true);
        });
        layui.each(jsonDeptData.PrivateOwner, function (index, item) {
            $('input:checkbox[DepartOnlyCode=' + item + '][TypeCode="dep-private-owner"]').prop('checked', true);
        });
        layui.each(jsonDeptData.CommonOwner, function (index, item) {
            $('input:checkbox[DepartOnlyCode=' + item + '][TypeCode="dep-common-owner"]').prop('checked', true);
        });
        layui.each(jsonDeptData.FyFellow, function (index, item) {
            $('input:checkbox[DepartOnlyCode=' + item + '][TypeCode="dep-fy-fellow"]').prop('checked', true);
        });
        layui.each(jsonDeptData.CustFellow, function (index, item) {
            $('input:checkbox[DepartOnlyCode=' + item + '][TypeCode="dep-cust-fellow"]').prop('checked', true);
        });
    },
    /// <summary>
    /// 获取门店树所选择节点
    /// </summary>
    GetDeptTreeSelectedNodes: function () {
        var zTreeObj = $.fn.zTree.getZTreeObj("deptTree");
        if (!zTreeObj) {
            return null;
        }
        var selectedNodes = zTreeObj.getSelectedNodes();
        return (!!selectedNodes && selectedNodes.length > 0) ? selectedNodes[0] : null;
    },
    /// <summary>
    /// 判断门店树是否选择一个部门
    ///<param name="node">当前选择节点</param>
    /// </summary>
    ValidateDeptTreeSelected: function (node) {
        if (!node) {
            layui.use('layer', function () {
                var layer = layui.layer;
                layer.alert("请选择一个部门");
            });
            return false;
        }
        return true;
    },
    GetUplusCanSeeSelectedNodesByTypeCode: function (typeCode) {
        switch (typeCode) {
            case 'dep-fy-sel':
                console.log(DepartmentIndex.FySelCanSeeSelectedNodes);
                return DepartmentIndex.FySelCanSeeSelectedNodes;
            case 'dep-cust-sel':
                return DepartmentIndex.CustSelCanSeeSelectedNodes;
            case 'dep-public-owner':
                return DepartmentIndex.PublicOwnerCanSeeSelectedNodes;
            case 'dep-private-owner':
                return DepartmentIndex.PrivateOwnerCanSeeSelectedNodes;
            case 'dep-common-owner':
                return DepartmentIndex.CommonOwnerCanSeeSelectedNodes;
            case 'dep-fy-fellow':
                return DepartmentIndex.FyFellowCanSeeSelectedNodes;
            case 'dep-cust-fellow':
                return DepartmentIndex.CustFellowCanSeeSelectedNodes;
        }
        return [];
    },
    GetUplusBeSeenSelectedNodesByTypeCode: function (typeCode) {
        switch (typeCode) {
            case 'dep-fy-sel':
                return DepartmentIndex.FySelBeSeenSelectedNodes;
            case 'dep-cust-sel':
                return DepartmentIndex.CustSelBeSeenSelectedNodes;
            case 'dep-public-owner':
                return DepartmentIndex.PublicOwnerBeSeenSelectedNodes;
            case 'dep-private-owner':
                return DepartmentIndex.PrivateOwnerBeSeenSelectedNodes;
            case 'dep-common-owner':
                return DepartmentIndex.CommonOwnerBeSeenSelectedNodes;
            case 'dep-fy-fellow':
                return DepartmentIndex.FyFellowBeSeenSelectedNodes;
            case 'dep-cust-fellow':
                return DepartmentIndex.CustFellowBeSeenSelectedNodes;
        }
        return [];
    },
    GetUplusParamNameByTypeCode: function (typeCode) {
        switch (typeCode) {
            case 'dep-fy-sel':
                return 'DepFySel';
            case 'dep-cust-sel':
                return 'DepCustSel';
            case 'dep-public-owner':
                return 'DepPublicOwner';
            case 'dep-private-owner':
                return 'DepPrivateOwner';
            case 'dep-common-owner':
                return 'DepCommonOwner';
            case 'dep-fy-fellow':
                return 'DepFyFellow';
            case 'dep-cust-fellow':
                return 'DepCustFellow';
        }
        return '';
    },
    ///<summary>
    ///刷新U+门店权限选择我能看的
    ///</summary>
    ///<param name="typeCode">选择的数据类型</param>
    ///<param name="data">返回的数据</param>
    ///<return></return>
    RefreshUplusCanSeeSelectedNodes: function (typeCode, data) {
        switch (typeCode) {
            case 'dep-fy-sel':
                DepartmentIndex.FySelCanSeeSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.FySelCanSeeSelectedNodes.push(this.DataCode);
                });
                break;
            case 'dep-cust-sel':
                DepartmentIndex.CustSelCanSeeSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.CustSelCanSeeSelectedNodes.push(this.DataCode);
                });
                break;
            case 'dep-public-owner':
                DepartmentIndex.PublicOwnerCanSeeSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.PublicOwnerCanSeeSelectedNodes.push(this.DataCode);
                });
                break;
            case 'dep-private-owner':
                DepartmentIndex.PrivateOwnerCanSeeSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.PrivateOwnerCanSeeSelectedNodes.push(this.DataCode);
                });
                break;
            case 'dep-common-owner':
                DepartmentIndex.CommonOwnerCanSeeSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.CommonOwnerCanSeeSelectedNodes.push(this.DataCode);
                });
                break;
            case 'dep-fy-fellow':
                DepartmentIndex.FyFellowCanSeeSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.FyFellowCanSeeSelectedNodes.push(this.DataCode);
                });
                break;
            case 'dep-cust-fellow':
                DepartmentIndex.CustFellowCanSeeSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.CustFellowCanSeeSelectedNodes.push(this.DataCode);
                });
                break;
        }
    },
    ///<summary>
    ///刷新U+门店权限选择能看我的
    ///</summary>
    ///<param name="typeCode">选择的数据类型</param>
    ///<param name="data">返回的数据</param>
    ///<return></return>
    RefreshUplusBeSeenSelectedNodes: function (typeCode, data) {
        switch (typeCode) {
            case 'dep-fy-sel':
                DepartmentIndex.FySelBeSeenSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.FySelBeSeenSelectedNodes.push(this.DepartOnlyCode);
                });
                break;
            case 'dep-cust-sel':
                DepartmentIndex.CustSelBeSeenSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.CustSelBeSeenSelectedNodes.push(this.DepartOnlyCode);
                });
                break;
            case 'dep-public-owner':
                DepartmentIndex.PublicOwnerBeSeenSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.PublicOwnerBeSeenSelectedNodes.push(this.DepartOnlyCode);
                });
                break;
            case 'dep-private-owner':
                DepartmentIndex.PrivateOwnerBeSeenSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.PrivateOwnerBeSeenSelectedNodes.push(this.DepartOnlyCode);
                });
                break;
            case 'dep-common-owner':
                DepartmentIndex.CommonOwnerBeSeenSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.CommonOwnerBeSeenSelectedNodes.push(this.DepartOnlyCode);
                });
                break;
            case 'dep-fy-fellow':
                DepartmentIndex.FyFellowBeSeenSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.FyFellowBeSeenSelectedNodes.push(this.DepartOnlyCode);
                });
                break;
            case 'dep-cust-fellow':
                DepartmentIndex.CustFellowBeSeenSelectedNodes = [];
                layui.each(data, function () {
                    DepartmentIndex.CustFellowBeSeenSelectedNodes.push(this.DepartOnlyCode);
                });
                break;
        }
    },
    ///<summary>
    ///批量刷新U+门店权限选择我能看的
    ///</summary>
    ///<param name="data">返回的数据</param>
    ///<return></return>
    BatchRefreshUplusCanSeeSelectedNodes: function (data) {
        DepartmentIndex.UplusCanSeeSelectedNodes = { FySel: [], CustSel: [], PublicOwner: [], PrivateOwner: [], CommonOwner: [], FyFellow: [], CustFellow: [] };
        layui.each(data, function () {
            switch (this.TypeCode) {
                case 'dep-fy-sel':
                    DepartmentIndex.UplusCanSeeSelectedNodes.FySel.push(this.DataCode);
                    break;
                case 'dep-cust-sel':
                    DepartmentIndex.UplusCanSeeSelectedNodes.CustSel.push(this.DataCode);
                    break;
                case 'dep-public-owner':
                    DepartmentIndex.UplusCanSeeSelectedNodes.PublicOwner.push(this.DataCode);
                    break;
                case 'dep-private-owner':
                    DepartmentIndex.UplusCanSeeSelectedNodes.PrivateOwner.push(this.DataCode);
                    break;
                case 'dep-common-owner':
                    DepartmentIndex.UplusCanSeeSelectedNodes.CommonOwner.push(this.DataCode);
                    break;
                case 'dep-fy-fellow':
                    DepartmentIndex.UplusCanSeeSelectedNodes.FyFellow.push(this.DataCode);
                    break;
                case 'dep-cust-fellow':
                    DepartmentIndex.UplusCanSeeSelectedNodes.CustFellow.push(this.DataCode);
                    break;
            }
        });
    },
    /// <summary>
    /// 根据treetable排序规则拼写HTML
    /// </summary>
    BuildDeptDataPermissionHTML: function (jsonArr) {
        var strHTML = '';//HTML字符串
        if (!jsonArr.length) {
            return strHTML;
        }
        //var listSorted = [];//根据reetable排序规则排序的json数组
        ////根据父节点升序排序，0为根节点
        //jsonArr = jsonArr.sort(function (a, b) {
        //    return a.ParentDeptNo - b.ParentDeptNo;
        //});
        ////递归查找子节点
        //jsonArr.forEach(function (item) {
        //    DepartmentIndex.DeptSortNodeInfo(item, jsonArr, listSorted);
        //});
        jsonArr.forEach(function (item) {
            strHTML += '<tr data-tt-id="' + item.DeptNo + '"  data-tt-parent-id="' + item.ParentDeptNo + '">';
            strHTML += '<td>' + item.DeptName + '</td>';
            strHTML += '<td><input type="checkbox" lay-skin="primary" DepartOnlyCode="' + item.DepartOnlyCode + '" TypeCode="dep-fy-sel"></td>';
            strHTML += '<td><input type="checkbox" lay-skin="primary" DepartOnlyCode="' + item.DepartOnlyCode + '" TypeCode="dep-cust-sel"></td>';
            strHTML += '<td><input type="checkbox" lay-skin="primary" DepartOnlyCode="' + item.DepartOnlyCode + '" TypeCode="dep-public-owner"></td>';
            strHTML += '<td><input type="checkbox" lay-skin="primary" DepartOnlyCode="' + item.DepartOnlyCode + '" TypeCode="dep-private-owner"></td>';
            strHTML += '<td><input type="checkbox" lay-skin="primary" DepartOnlyCode="' + item.DepartOnlyCode + '" TypeCode="dep-common-owner"></td>';
            strHTML += '<td><input type="checkbox" lay-skin="primary" DepartOnlyCode="' + item.DepartOnlyCode + '" TypeCode="dep-fy-fellow"></td>';
            strHTML += '<td><input type="checkbox" lay-skin="primary" DepartOnlyCode="' + item.DepartOnlyCode + '" TypeCode="dep-cust-fellow"></td>';
            strHTML += '</tr>';
        });
        return strHTML;
    },
    /// <summary>
    /// 根据treetable排序规则递归添加json数组
    /// </summary>
    DeptSortNodeInfo: function (obj, jsonArr, listSorted) {
        //去重，已经存在直接跳过
        if (listSorted.indexOf(obj) >= 0) {
            return;
        }
        listSorted.push(obj);
        delete jsonArr[jsonArr.indexOf(obj)];
        if (!obj.DeptNo) {
            return;
        }
        //递归查找子节点
        jsonArr.forEach(function (item) {
            if (obj.ID == item.ParentDeptNo) {
                DepartmentIndex.DeptSortNodeInfo(item, jsonArr, listSorted);
            }
        });
    },
    ///<summary>
    ///获取ztree所有父节点
    ///</summary>
    ///<param name="parentDeptNo">当前节点的parentDeptNo</param>
    ///<param name="deptList">树的所有节点</param>
    ///<param name="listSorted">返回节点集合</param>
    ///<return></return>
    GetParentNode: function (parentDeptNo, deptList, listSorted) {
        if (DepartmentIndex.IsContain(parentDeptNo, listSorted)) {
            return;
        }
        for (var i = 0; i < deptList.length; i++) {
            if (parentDeptNo == deptList[i].DeptNo) {
                listSorted.push(deptList[i]);
                DepartmentIndex.GetParentNode(deptList[i].ParentDeptNo, deptList, listSorted);
            }
        }
    },
    ///<summary>
    ///获取ztree所有子节点
    ///</summary>
    ///<param name="deptno">当前节点的deptno</param>
    ///<param name="deptList">树的所有节点</param>
    ///<param name="listSorted">返回节点集合</param>
    ///<return></return>
    GetChildNode: function (deptno, deptList, listSorted) {
        //if (DepartmentIndex.IsContain(deptno, listSorted)) {
        //	return;
        //}
        for (var i = 0; i < deptList.length; i++) {
            if (deptno == deptList[i].DeptNo) {
                if (listSorted.indexOf(deptList[i]) <= 0) {
                    listSorted.push(deptList[i]);
                }
            }
            if (deptno == deptList[i].ParentDeptNo) {
                listSorted.push(deptList[i]);
                DepartmentIndex.GetChildNode(deptList[i].DeptNo, deptList, listSorted);
            }
        }
    },
    IsContain: function (deptNo, listSorted) {
        for (var i = 0; i < listSorted.length; i++) {
            if (deptNo == listSorted[i].DeptNo) {
                return true;
            }
        }
        return false;
    },
    ///<summary>
    ///获取ztree所有子节点
    ///</summary>
    ///<param name="dept">选择的部门</param>
    ///<param name="deptList">树的所有节点</param>
    ///<return>返回选择部门的节点集合</return>
    GetTreeListSorted: function (dept, deptList) {
        var listSorted = [];
        DepartmentIndex.GetParentNode($(dept).attr('ParentDeptNo'), deptList, listSorted);
        DepartmentIndex.GetChildNode($(dept).attr('DeptNo'), deptList, listSorted);
        return listSorted;
    },
}

$(function () {
    DepartmentIndex.Init();
});
